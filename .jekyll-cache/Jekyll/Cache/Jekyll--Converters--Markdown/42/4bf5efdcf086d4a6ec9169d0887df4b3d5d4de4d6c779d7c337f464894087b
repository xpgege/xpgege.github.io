I"ím<h1 id="åˆå¹¶å­ŸåŠ æ‹‰å’Œé©¬æ‹‰ç»´æ•°æ®åˆ†æ">åˆå¹¶å­ŸåŠ æ‹‰å’Œé©¬æ‹‰ç»´æ•°æ®åˆ†æ</h1>

<h2 id="åˆå¹¶æ•°æ®">åˆå¹¶æ•°æ®</h2>

<p>å°†å­ŸåŠ æ‹‰å’Œé©¬æ‹‰ç»´çš„æ‰€æœ‰æ•°æ®è¿›è¡Œåˆå¹¶ï¼Œç»Ÿä¸€åˆ†æã€‚é¦–å…ˆåˆ›å»ºæ‰€æœ‰å¥åº·æ ·æœ¬çš„<code class="language-plaintext highlighter-rouge">manifest</code>æ•°æ®ã€‚ç„¶åå¯¼å…¥åˆ°QIIME2ä¸­ã€‚æ–‡ä»¶åˆ†æè·¯å¾„ä½äº<code class="language-plaintext highlighter-rouge">Storage3/Micro-Develop/ref7_13</code>ä¸‹</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># æ¿€æ´»ç¯å¢ƒ</span>
<span class="nb">export </span><span class="nv">LC_ALL</span><span class="o">=</span>en_US.utf-8
<span class="nb">export </span><span class="nv">LANG</span><span class="o">=</span>en_US.utf-8
conda activate qiime2-2020.2

<span class="c"># å°†åŒç«¯æµ‹åºæ•°æ®è¾“å…¥</span>
qiime tools import <span class="nt">--type</span> <span class="s1">'SampleData[PairedEndSequencesWithQuality]'</span> <span class="se">\</span>
<span class="nt">--input-path</span> Healthy_cohort_manifest.txt <span class="nt">--output-path</span> pe_sequence.qza <span class="se">\</span>
<span class="nt">--input-format</span> PairedEndFastqManifestPhred33V2

qiime vsearch join-pairs <span class="se">\</span>
  <span class="nt">--i-demultiplexed-seqs</span> pe_sequence.qza <span class="se">\</span>
  <span class="nt">--o-joined-sequences</span> pe-joined.qza
  
<span class="c"># è·å–æ•°æ®çš„è´¨é‡å›¾åƒ</span>
qiime demux summarize <span class="nt">--i-data</span> pe-joined.qza <span class="se">\</span>
<span class="nt">--o-visualization</span> pe_sequence.qzv
</code></pre></div></div>

<h3 id="æ•°æ®è´¨æ§">æ•°æ®è´¨æ§</h3>

<p>åˆå¹¶åçš„æ•°æ®çš„è´¨é‡å¦‚å›¾æ‰€ç¤º</p>

<p><img src="https://hugo-blog-1256988836.cos.ap-chengdu.myqcloud.com/16S/Micor-develop/ref7_13/combined_reads_quality.png" alt="" /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>qiime quality-filter q-score-joined <span class="se">\</span>
  <span class="nt">--i-demux</span> pe-joined.qza <span class="se">\</span>
  <span class="nt">--p-min-quality</span> 20 <span class="se">\</span>
  <span class="nt">--o-filtered-sequences</span> demux-joined-filtered.qza <span class="se">\</span>
  <span class="nt">--o-filter-stats</span> demux-joined-filter-stats.qza
  
qiime deblur denoise-16S <span class="se">\</span>
  <span class="nt">--i-demultiplexed-seqs</span> demux-joined-filtered.qza <span class="se">\</span>
  <span class="nt">--p-trim-length</span> 220 <span class="se">\</span>
  <span class="nt">--p-sample-stats</span> <span class="se">\</span>
  <span class="nt">--o-representative-sequences</span> rep-seqs.qza <span class="se">\</span>
  <span class="nt">--o-table</span> table.qza <span class="se">\</span>
  <span class="nt">--o-stats</span> deblur-stats.qza
  
qiime feature-table summarize <span class="se">\</span>
  <span class="nt">--i-table</span> table.qza <span class="se">\</span>
  <span class="nt">--o-visualization</span> table.qzv
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Metric</th>
      <th style="text-align: left">Sample</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Number of samples</td>
      <td style="text-align: left">1,262</td>
    </tr>
    <tr>
      <td style="text-align: left">Number of features</td>
      <td style="text-align: left">3,546</td>
    </tr>
    <tr>
      <td style="text-align: left">Total frequency</td>
      <td style="text-align: left">22,182,088</td>
    </tr>
  </tbody>
</table>

<h3 id="frequency-per-sample">Frequency per sample</h3>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Â </th>
      <th style="text-align: center">Frequency</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Minimum frequency</td>
      <td style="text-align: center">360.0</td>
    </tr>
    <tr>
      <td style="text-align: left">1st quartile</td>
      <td style="text-align: center">7,507.0</td>
    </tr>
    <tr>
      <td style="text-align: left">Median frequency</td>
      <td style="text-align: center">12,222.0</td>
    </tr>
    <tr>
      <td style="text-align: left">3rd quartile</td>
      <td style="text-align: center">18,097.0</td>
    </tr>
    <tr>
      <td style="text-align: left">Maximum frequency</td>
      <td style="text-align: center">561,071.0</td>
    </tr>
    <tr>
      <td style="text-align: left">Mean frequency</td>
      <td style="text-align: center">17,576.931854199684</td>
    </tr>
  </tbody>
</table>

<h3 id="ç¨€é‡Š">ç¨€é‡Š</h3>

<p>ä»¥3000ä¸ºæ ‡å‡†è¿›è¡Œç¨€é‡Šã€‚</p>

<p><img src="https://hugo-blog-1256988836.cos.ap-chengdu.myqcloud.com/16S/Micor-develop/ref7_13/%E7%A8%80%E9%87%8A%E6%9B%B2%E7%BA%BF.png" alt="" /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">## è¿›åŒ–æ ‘</span>
qiime phylogeny align-to-tree-mafft-fasttree <span class="se">\</span>
  <span class="nt">--i-sequences</span> rep-seqs.qza <span class="se">\</span>
  <span class="nt">--o-alignment</span> aligned-rep-seqs.qza <span class="se">\</span>
  <span class="nt">--o-masked-alignment</span> masked-aligned-rep-seqs.qza <span class="se">\</span>
  <span class="nt">--o-tree</span> unrooted-tree.qza <span class="se">\</span>
  <span class="nt">--o-rooted-tree</span> rooted-tree.qza

qiime diversity alpha-rarefaction <span class="se">\</span>
  <span class="nt">--i-table</span> table.qza <span class="se">\</span>
  <span class="nt">--i-phylogeny</span> rooted-tree.qza <span class="se">\</span>
  <span class="nt">--p-max-depth</span> 3000 <span class="se">\</span>
  <span class="nt">--m-metadata-file</span> metadata.txt <span class="se">\</span>
  <span class="nt">--o-visualization</span> alpha-rarefaction.qzv
  
<span class="c"># ç¨€é‡Š</span>
qiime diversity core-metrics-phylogenetic <span class="se">\</span>
  <span class="nt">--i-phylogeny</span> rooted-tree.qza <span class="se">\</span>
  <span class="nt">--i-table</span> table.qza  <span class="se">\</span>
  <span class="nt">--p-sampling-depth</span> 3000 <span class="se">\</span>
  <span class="nt">--m-metadata-file</span> metadata.txt <span class="se">\</span>
  <span class="nt">--output-dir</span> core-metrics
  
<span class="c"># ASV taxa assign</span>
qiime feature-classifier classify-sklearn <span class="se">\</span>
    <span class="nt">--i-classifier</span> ../ref_7/gg-13-8-99-nb-classifier.qza <span class="se">\</span>
    <span class="nt">--i-reads</span> rep-seqs.qza <span class="se">\</span>
    <span class="nt">--o-classification</span> taxonomy.qza
    
 qiime metadata tabulate <span class="se">\</span>
    <span class="nt">--m-input-file</span> taxonomy.qza <span class="se">\</span>
    <span class="nt">--o-visualization</span> taxonomy.qzv
    
 <span class="c"># collaspe taxa abundance</span>
 qiime taxa barplot <span class="se">\</span>
  <span class="nt">--i-table</span> core-metrics/rarefied_table.qza <span class="se">\</span>
  <span class="nt">--i-taxonomy</span> taxonomy.qza <span class="se">\</span>
  <span class="nt">--m-metadata-file</span> metadata.txt <span class="se">\</span>
  <span class="nt">--o-visualization</span> rarefied_taxa-bar-plots.qzv
  
<span class="c"># ASV abundance</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> ASV<span class="p">;</span> <span class="nb">cd </span>ASV
<span class="nb">cp</span> ../core-metrics/rarefied_table.qza rarefied_table.zip
unzip rarefied_table.zip<span class="p">;</span>  <span class="c"># éœ€è¦å¯¹è§£å‹ä¸‹çš„æ–‡ä»¶å¤¹é‡å‘½åï¼Œæ¯”å¦‚å‘½åä¸ºrarefied_table</span>
<span class="nb">cd </span>rarefied_table/data<span class="p">;</span>
biom convert <span class="nt">-i</span> feature-table.biom <span class="nt">-o</span> asv_table.txt <span class="nt">--to-tsv</span>
</code></pre></div></div>

<h2 id="qiime2åˆ†æ">QIIME2åˆ†æ</h2>

<h3 id="å¹´é¾„å’Œalphaå¤šæ ·æ€§"><em>å¹´é¾„å’Œalphaå¤šæ ·æ€§</em></h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>qiime diversity alpha-correlation <span class="se">\</span>
    <span class="nt">--m-metadata-file</span> metadata.txt <span class="se">\</span>
    <span class="nt">--i-alpha-diversity</span> core-metrics/observed_otus_vector.qza <span class="se">\</span>
    <span class="nt">--o-visualization</span>  core-metrics/observed_otus_correlation.qzv
</code></pre></div></div>

<p><img src="https://hugo-blog-1256988836.cos.ap-chengdu.myqcloud.com/16S/Micor-develop/ref7_13/alpha-correlation.svg" alt="" /></p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Test</th>
      <th style="text-align: left">Spearman</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Test statistic</strong></td>
      <td style="text-align: left">0.6847</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>P-value</strong></td>
      <td style="text-align: left">0.0000</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Sample size</strong></td>
      <td style="text-align: left">1161</td>
    </tr>
  </tbody>
</table>

<p>æ•´ä½“è€Œè¨€ï¼Œéšç€å¹´é¾„çš„é€æ­¥æå‡ï¼Œè§‚æµ‹åˆ°çš„å¾®ç”Ÿç‰©å¤šæ ·æ€§ä¹Ÿæ˜¯é€æ­¥ä¸Šå‡çš„ã€‚</p>

<h3 id="å¥‡æ€ªçš„pcoaå›¾">å¥‡æ€ªçš„PCoAå›¾</h3>

<blockquote>
  <p>jaccard pcoa</p>
</blockquote>

<p><img src="https://hugo-blog-1256988836.cos.ap-chengdu.myqcloud.com/16S/Micor-develop/ref7_13/emperor-jaccard.svg" alt="" /></p>

<blockquote>
  <p>unweighted unifrac</p>
</blockquote>

<p><img src="https://hugo-blog-1256988836.cos.ap-chengdu.myqcloud.com/16S/Micor-develop/ref7_13/emperor-unweight-unifrac.svg" alt="" /></p>

<p>ä¸Šå›¾ä¸­ï¼Œçº¢è‰²æ˜¯å­ŸåŠ æ‹‰æ•°æ®ï¼Œè€Œæ©™è‰²ä¸ºå…¶æ–‡ä¸­æåˆ°çš„éªŒè¯é©¬æ‹‰ç»´æ•°æ®ã€‚è“è‰²ä¸ºé©¬æ‹‰ç»´æ•°æ®ã€‚æ•°æ®åˆ†æˆäº†ä¸¤ä¸ªæ¥è¿‘å¹³è¡Œçš„æœˆç‰™ï¼Œå‘ˆç°å‡ºè¾ƒä¸ºå¥‡æ€ªçš„ç‰¹å¾ã€‚</p>

<h2 id="éšæœºæ£®æ—æ¨¡å‹">éšæœºæ£®æ—æ¨¡å‹</h2>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rm</span><span class="p">(</span><span class="n">list</span><span class="o">=</span><span class="n">ls</span><span class="p">())</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">randomForest</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">

</span><span class="n">abundance</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="s2">"asv_table.txt"</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">,</span><span class="n">check.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">relative_abundance</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">abundance</span><span class="o">/</span><span class="m">3000</span><span class="o">*</span><span class="m">100</span><span class="w">
</span><span class="n">count</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">abun</span><span class="p">){</span><span class="w">
     </span><span class="n">num</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">abun</span><span class="o">&gt;</span><span class="m">0.1</span><span class="p">)</span><span class="w">
     </span><span class="nf">return</span><span class="p">(</span><span class="n">num</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">filter_count</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">relative_abundance</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="n">count</span><span class="p">)</span><span class="w">
 
</span><span class="n">index</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">which</span><span class="p">(</span><span class="n">filter_count</span><span class="o">&gt;</span><span class="m">8</span><span class="p">)</span><span class="w"> 
</span><span class="n">filter_abundance</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">relative_abundance</span><span class="p">[</span><span class="n">index</span><span class="p">,]</span><span class="w">
</span><span class="n">metadata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="s2">"metadata.txt"</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">)</span><span class="w">
</span><span class="n">otu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">filter_abundance</span><span class="p">))</span><span class="w">
</span><span class="n">otu</span><span class="o">$</span><span class="n">Age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">metadata</span><span class="p">[</span><span class="n">rownames</span><span class="p">(</span><span class="n">otu</span><span class="p">),]</span><span class="o">$</span><span class="n">Age</span><span class="w">

</span><span class="c1"># train and valid samples</span><span class="w">
</span><span class="n">train_index</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="n">rownames</span><span class="p">(</span><span class="n">otu</span><span class="p">),</span><span class="n">nrow</span><span class="p">(</span><span class="n">otu</span><span class="p">)</span><span class="o">*</span><span class="m">0.7</span><span class="p">)</span><span class="w">
</span><span class="n">valid_index</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">setdiff</span><span class="p">(</span><span class="n">rownames</span><span class="p">(</span><span class="n">otu</span><span class="p">),</span><span class="n">train_index</span><span class="p">)</span><span class="w"> 
</span><span class="n">train_sample</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">otu</span><span class="p">[</span><span class="n">train_index</span><span class="p">,]</span><span class="w">
</span><span class="n">valid_sample</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">otu</span><span class="p">[</span><span class="n">valid_index</span><span class="p">,]</span><span class="w">

</span><span class="c1">## é€‰æ‹©å¹´é¾„åŒºé—´ä¸º1-18æœˆ</span><span class="w">
</span><span class="c1">#train_sample &lt;- train_sample[which(train_sample$Age&lt;18),]</span><span class="w">
</span><span class="c1">#valid_sample &lt;- valid_sample[which(valid_sample$Age&lt;18),]</span><span class="w">

</span><span class="c1"># RF Glimpse</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span><span class="w">  </span><span class="c1"># åˆ›å»ºéšæœºç§å­ï¼Œä»è€Œä½¿å¾—ç»“æœå¯é‡å¤</span><span class="w">
</span><span class="n">otu_train.forest</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">randomForest</span><span class="p">(</span><span class="n">Age</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train_sample</span><span class="p">,</span><span class="w"> </span><span class="n">importance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="c1">## å¼€å§‹è®­ç»ƒ</span><span class="w">
</span><span class="n">otu_train.forest</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>Call:
randomForest(formula = Age ~ ., data = train_sample, importance = TRUE) 
              Type of random forest: regression
                    Number of trees: 500
No. of variables tried at each split: 179</p>

  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     Mean of squared residuals: 14.92069
               % Var explained: 72.48
</code></pre></div>  </div>
</blockquote>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">importance_otu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">otu_train.forest</span><span class="o">$</span><span class="n">importance</span><span class="p">)</span><span class="w">
</span><span class="n">varImpPlot</span><span class="p">(</span><span class="n">otu_train.forest</span><span class="p">,</span><span class="w"> </span><span class="n">n.var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">otu_train.forest</span><span class="o">$</span><span class="n">importance</span><span class="p">)),</span><span class="w">
</span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Top 30 - variable importance'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://hugo-blog-1256988836.cos.ap-chengdu.myqcloud.com/16S/Micor-develop/ref7_13/variable_importance.png" alt="" /></p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">importance_otu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">importance_otu</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">importance_otu</span><span class="o">$</span><span class="n">IncNodePurity</span><span class="p">,</span><span class="w"> </span><span class="n">decreasing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">write.table</span><span class="p">(</span><span class="n">importance_otu</span><span class="p">,</span><span class="w"> </span><span class="s1">'importance_otu.txt'</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'\t'</span><span class="p">,</span><span class="w"> </span><span class="n">col.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">quote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="n">otu_train</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train_sample</span><span class="w">
</span><span class="n">otu_train.cv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">replicate</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">rfcv</span><span class="p">(</span><span class="n">otu_train</span><span class="p">[</span><span class="o">-</span><span class="n">ncol</span><span class="p">(</span><span class="n">otu_train</span><span class="p">)],</span><span class="w"> </span><span class="n">otu_train</span><span class="o">$</span><span class="n">Age</span><span class="p">,</span><span class="w"> </span><span class="n">cv.fold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">),</span><span class="w"> </span><span class="n">simplify</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">otu_train.cv</span><span class="w">
</span><span class="n">otu_train.cv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="n">otu_train.cv</span><span class="p">,</span><span class="w"> </span><span class="s1">'[['</span><span class="p">,</span><span class="w"> </span><span class="s1">'error.cv'</span><span class="p">))</span><span class="w">
</span><span class="n">otu_train.cv</span><span class="o">$</span><span class="n">otus</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">otu_train.cv</span><span class="p">)</span><span class="w">
</span><span class="n">otu_train.cv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">reshape2</span><span class="o">::</span><span class="n">melt</span><span class="p">(</span><span class="n">otu_train.cv</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'otus'</span><span class="p">)</span><span class="w">
</span><span class="n">otu_train.cv</span><span class="o">$</span><span class="n">otus</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">otu_train.cv</span><span class="o">$</span><span class="n">otus</span><span class="p">))</span><span class="w">
</span><span class="n">otu_train.cv.mean</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aggregate</span><span class="p">(</span><span class="n">otu_train.cv</span><span class="o">$</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">otu_train.cv</span><span class="o">$</span><span class="n">otus</span><span class="p">),</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">otu_train.cv.mean</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">Group.1</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">theme</span><span class="p">(</span><span class="n">panel.grid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w"> </span><span class="n">panel.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_rect</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'black'</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'transparent'</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span><span class="p">,</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Number of OTUs'</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Cross-validation error'</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">otu_train.cv.mean</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>Group.1        x<br />
  1        1 45.04694<br />
  2        2 35.18462<br />
  3        3 28.71272<br />
  4        4 25.08448<br />
  5        6 21.38917<br />
  6        9 18.89489<br />
  7       14 17.99712<br />
  8       21 17.23732<br />
  9       31 16.97913<br />
  10      47 16.47820<br />
  11      71 15.81818<br />
  12     106 15.55566<br />
  13     159 15.45693<br />
  14     239 15.39939<br />
  15     358 15.45632<br />
  16     537 15.55963</p>
</blockquote>

<p>21 is good.</p>

<h3 id="21ä¸ªå˜é‡çš„ç®€çº¦å›å½’">21ä¸ªå˜é‡çš„ç®€çº¦å›å½’</h3>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">importance_otu.select</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">importance_otu</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">otu_id.select</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">importance_otu.select</span><span class="p">)</span><span class="w">
</span><span class="n">write.table</span><span class="p">(</span><span class="n">importance_otu.select</span><span class="p">,</span><span class="w"> </span><span class="s1">'importance_otu.select.txt'</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'\t'</span><span class="p">,</span><span class="w"> </span><span class="n">col.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">quote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="c1">##åªåŒ…å«21ä¸ªé‡è¦é¢„æµ‹å˜é‡çš„ç®€çº¦å›å½’</span><span class="w">
</span><span class="n">otu_train.select</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train_sample</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="n">otu_id.select</span><span class="p">,</span><span class="s2">"Age"</span><span class="p">)]</span><span class="w">
</span><span class="n">otu_test.select</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">valid_sample</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="n">otu_id.select</span><span class="p">,</span><span class="s2">"Age"</span><span class="p">)]</span><span class="w">

</span><span class="c1">#éšæœºæ£®æ—è®¡ç®—ï¼ˆé»˜è®¤ç”Ÿæˆ 500 æ£µå†³ç­–æ ‘ï¼‰ï¼Œè¯¦æƒ… ?randomForest</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span><span class="w">
</span><span class="n">otu_train.select.forest</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">randomForest</span><span class="p">(</span><span class="n">Age</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">otu_train.select</span><span class="p">,</span><span class="w"> </span><span class="n">importance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>otu_train.select.forest</p>
</blockquote>

<blockquote>
  <p>Call:
 randomForest(formula = Age ~ ., data = otu_train.select, importance = TRUE) 
               Type of random forest: regression
                     Number of trees: 500
No. of variables tried at each split: 7</p>

  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      Mean of squared residuals: 16.86074
                % Var explained: 68.9
</code></pre></div>  </div>
</blockquote>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">names</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">otu_test.select</span><span class="p">)</span><span class="w">
</span><span class="n">age_predict</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">otu_train.select.forest</span><span class="p">,</span><span class="w"> </span><span class="n">otu_test.select</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">otu_test.select</span><span class="o">$</span><span class="n">Age</span><span class="p">,</span><span class="w"> </span><span class="n">age_predict</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Test'</span><span class="p">,</span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'age (Months)'</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Predict'</span><span class="p">)</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://hugo-blog-1256988836.cos.ap-chengdu.myqcloud.com/16S/Micor-develop/ref7_13/predict.png" alt="" /></p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Test_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">otu_test.select</span><span class="o">$</span><span class="n">Age</span><span class="p">,</span><span class="w"> </span><span class="n">age_predict</span><span class="p">)</span><span class="w">
</span><span class="n">Test_Fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">age_predict</span><span class="o">~</span><span class="n">otu_test.select.Age</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">Test_data</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">Test_Fit</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>Call:<br />
lm(formula = age_predict ~ otu_test.select.Age, data = Test_data)</p>

  <p>Residuals:<br />
    Min       1Q   Median       3Q      Max <br />
-10.4187  -1.9778   0.0438   1.8712   9.3173</p>

  <p>Coefficients:<br />
                   Estimate Std. Error t value Pr(&gt;|t|)  <br />
(Intercept)          3.66695    0.29330   12.50   &lt;2e-16 ***</p>

  <p>otu_test.select.Age  0.71086    0.02236   31.79   &lt;2e-16 ***</p>

  <p>Signif. codes:  0 â€˜<em><strong>â€™ 0.001 â€˜</strong>â€™ 0.01 â€˜</em>â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1</p>

  <p>Residual standard error: 2.928 on 347 degrees of freedom<br />
Multiple R-squared:  0.7444,	Adjusted R-squared:  0.7437 <br />
F-statistic:  1011 on 1 and 347 DF,  p-value: &lt; 2.2e-16</p>
</blockquote>

<h3 id="ç‰©ç§åˆ†æ">ç‰©ç§åˆ†æ</h3>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ASV_taxa</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="s2">"taxonomy.txt"</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">,</span><span class="n">check.names</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w">
</span><span class="n">select</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="s2">"importance_otu.select.txt"</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">,</span><span class="n">check.names</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w">
</span><span class="n">result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inner_join</span><span class="p">(</span><span class="n">ASV_taxa</span><span class="p">,</span><span class="n">select</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="s2">"ASV"</span><span class="p">)</span><span class="w">
</span><span class="n">result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">result</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">result</span><span class="o">$</span><span class="n">IncNodePurity</span><span class="p">,</span><span class="w"> </span><span class="n">decreasing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">write.table</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="s2">"Select_asv_taxa.txt"</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="nb">F</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<table>
  <thead>
    <tr>
      <th>ASV</th>
      <th>Taxon</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>f118662f3e5f209f582ffbaf39e21807</td>
      <td>Bacteria; Firmicutes; Clostridia; Clostridiales; Lachnospiraceae;  Blautia; s__</td>
    </tr>
    <tr>
      <td>c7dad10896f6c10619ec4d963d5a0d4c</td>
      <td>Bacteria; Firmicutes; Clostridia; Clostridiales; Lachnospiraceae; Dorea;  s__longicatena</td>
    </tr>
    <tr>
      <td>c3ae999022b2b3dba38bf8d4e08242c1</td>
      <td>Bacteria; Firmicutes; Clostridia; Clostridiales; Lachnospiraceae; Dorea;  s__formicigenerans</td>
    </tr>
    <tr>
      <td>ed8930aed9ccc63f5b22fd4229ef3361</td>
      <td>Bacteria; Firmicutes; Clostridia; Clostridiales; Ruminococcaceae;  Gemmiger; s__formicilis</td>
    </tr>
    <tr>
      <td>6c38c23dde65be3184382ccaafdbc7aa</td>
      <td>Bacteria; Firmicutes; Bacilli; Bacillales; Staphylococcaceae;  Staphylococcus</td>
    </tr>
    <tr>
      <td>b99a5879168a9d117fdffb707e1f682c</td>
      <td>Bacteria; Firmicutes; Clostridia; Clostridiales; Lachnospiraceae;  Blautia; s__</td>
    </tr>
    <tr>
      <td>2792f7e5c84a91ba5a549be947465cb6</td>
      <td>Bacteria; Actinobacteria; Actinobacteria; Bifidobacteriales;  Bifidobacteriaceae; Bifidobacterium</td>
    </tr>
    <tr>
      <td>f00219cfb5ea9d13f4be1e63c6822722</td>
      <td>Bacteria; Firmicutes; Clostridia; Clostridiales; Ruminococcaceae;  Faecalibacterium; s__prausnitzii</td>
    </tr>
    <tr>
      <td>7be3fed5631db826c499e1f0f3d5bff1</td>
      <td>Bacteria; Firmicutes; Clostridia; Clostridiales; Lachnospiraceae;  Roseburia; s__faecis</td>
    </tr>
    <tr>
      <td>2ea082fe7de3327a025e61006313746b</td>
      <td>Bacteria; Proteobacteria; Gammaproteobacteria; Pasteurellales;  Pasteurellaceae; Haemophilus; s__parainfluenzae</td>
    </tr>
    <tr>
      <td>c60a6281dea0f58a0154c2efcdb19cff</td>
      <td>Bacteria; Firmicutes; Bacilli; Lactobacillales; Lactobacillaceae;  Lactobacillus; s__ruminis</td>
    </tr>
    <tr>
      <td>c878ea3979de4d780d7e3e9b37797c9f</td>
      <td>Bacteria; Actinobacteria; Actinobacteria; Bifidobacteriales;  Bifidobacteriaceae; Bifidobacterium; s__</td>
    </tr>
    <tr>
      <td>98aaddfc3162f1cc9f308cc008748a28</td>
      <td>Bacteria; Firmicutes; Clostridia; Clostridiales; Lachnospiraceae;  Blautia; s__obeum</td>
    </tr>
    <tr>
      <td>3a9fc45622619d3fd38007c1852eb7cd</td>
      <td>Bacteria; Bacteroidetes; Bacteroidia; Bacteroidales; Prevotellaceae;  Prevotella; s__copri</td>
    </tr>
    <tr>
      <td>28122e04ec3fd0344659c8d74bd7d78b</td>
      <td>Bacteria; Firmicutes; Clostridia; Clostridiales; Lachnospiraceae</td>
    </tr>
    <tr>
      <td>e96d365cd48141668838c3f8121fa21a</td>
      <td>Bacteria; Firmicutes; Clostridia; Clostridiales; Lachnospiraceae;  Coprococcus; s__catus</td>
    </tr>
    <tr>
      <td>fd0a3dc53155f8a85951b9ee8addb8b0</td>
      <td>Bacteria; Firmicutes; Bacilli; Lactobacillales; Lactobacillaceae;  Lactobacillus; s__mucosae</td>
    </tr>
    <tr>
      <td>1585491003a692e661e3e84794a0c541</td>
      <td>Bacteria; Proteobacteria; Gammaproteobacteria; Enterobacteriales;  Enterobacteriaceae</td>
    </tr>
    <tr>
      <td>b97be820e4bf0d5a3c32cfb1f1512a40</td>
      <td>Bacteria</td>
    </tr>
    <tr>
      <td>fb9fff85b91dae8de2154b82cd2ca4b5</td>
      <td>Bacteria; Firmicutes; Clostridia; Clostridiales; Ruminococcaceae;  Faecalibacterium; s__prausnitzii</td>
    </tr>
    <tr>
      <td>88bad5fd626727f0d8fef57f9dbb6e0f</td>
      <td>Bacteria; Firmicutes; Bacilli; Lactobacillales; Enterococcaceae;  Enterococcus</td>
    </tr>
  </tbody>
</table>

<p>ä¸Šè¿°è¡¨æ ¼ä¸ºæŒ‰ç…§<code class="language-plaintext highlighter-rouge">importance score</code>æ’åˆ—æ‰€å¾—ã€‚</p>

<h3 id="summary">Summary</h3>

<p>å¤šä¸ªæ•°æ®é›†ä¹‹é—´æ˜¯å¯ä»¥åˆå¹¶åˆ†æçš„ï¼Œå¹¶ä¸”å…·æœ‰è¾ƒå¥½çš„ä¸€è‡´æ€§ã€‚</p>

<h3 id="æ•°æ®å­é›†åˆ†æ18-months">æ•°æ®å­é›†åˆ†æï¼ˆ&lt;18 monthsï¼‰</h3>

<p>ç”±äºæ•°æ®æ··åˆå’Œæ—¶é—´è·¨åº¦è¿‡å¤§ï¼ŒçŒœæµ‹æ˜¯å¦æ˜¯å¹´é¾„å¤ªå¤§ä¼šå¸¦æ¥æ‹Ÿåˆä¸Šçš„é—®é¢˜ã€‚æ•…é€‰å–æ•°æ®ä¸º18ä¸ªæœˆä»¥å†…çš„æ•°æ®è¿›è¡Œåˆ†æ</p>

<p>æˆ‘ä»¬çš„å˜é‡å­˜å‚¨åœ¨<code class="language-plaintext highlighter-rouge">otu</code>ä¸­,ç­›é€‰åä¿ç•™920ä¸ªæ ·æœ¬ï¼ŒåŒ…å«745ä¸ªå­ŸåŠ æ‹‰æ ·æœ¬å’Œ175é©¬æ‹‰ç»´æ ·æœ¬ã€‚</p>

<p>ä»ç„¶ä»¥0.7å’Œ0.3çš„æ¯”ä¾‹é€‰å–è®­ç»ƒå’Œæµ‹è¯•æ ·æœ¬ã€‚å¯¹åº”637å’Œ273ä¸ªè®­ç»ƒæµ‹è¯•æ ·æœ¬</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">otu_subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">otu</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">otu</span><span class="o">$</span><span class="n">Age</span><span class="o">&lt;=</span><span class="m">18</span><span class="p">),]</span><span class="w">
</span><span class="n">train_index</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="n">rownames</span><span class="p">(</span><span class="n">otu_subset</span><span class="p">),</span><span class="n">nrow</span><span class="p">(</span><span class="n">otu_subset</span><span class="p">)</span><span class="o">*</span><span class="m">0.7</span><span class="p">)</span><span class="w">
</span><span class="n">valid_index</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">setdiff</span><span class="p">(</span><span class="n">rownames</span><span class="p">(</span><span class="n">otu_subset</span><span class="p">),</span><span class="n">train_index</span><span class="p">)</span><span class="w"> 
</span><span class="n">train_sample</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">otu_subset</span><span class="p">[</span><span class="n">train_index</span><span class="p">,]</span><span class="w">
</span><span class="n">valid_sample</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">otu_subset</span><span class="p">[</span><span class="n">valid_index</span><span class="p">,]</span><span class="w">
</span><span class="c1"># RF Glimpse</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span><span class="w">  </span><span class="c1"># åˆ›å»ºéšæœºç§å­ï¼Œä»è€Œä½¿å¾—ç»“æœå¯é‡å¤</span><span class="w">
</span><span class="n">otu_train.forest</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">randomForest</span><span class="p">(</span><span class="n">Age</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train_sample</span><span class="p">,</span><span class="w"> </span><span class="n">importance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="c1">## å¼€å§‹è®­ç»ƒ</span><span class="w">
</span><span class="n">otu_train.forest</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>Call:
randomForest(formula = Age ~ ., data = train_sample, importance = TRUE) 
              Type of random forest: regression
                    Number of trees: 500
No. of variables tried at each split: 179</p>

  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     Mean of squared residuals: 8.873464
               % Var explained: 64.2
</code></pre></div>  </div>
</blockquote>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">importance_otu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">otu_train.forest</span><span class="o">$</span><span class="n">importance</span><span class="p">)</span><span class="w">
</span><span class="n">importance_otu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">importance_otu</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">importance_otu</span><span class="o">$</span><span class="n">IncNodePurity</span><span class="p">,</span><span class="w"> </span><span class="n">decreasing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">otu_train</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train_sample</span><span class="w">
</span><span class="n">otu_train.cv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">replicate</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">rfcv</span><span class="p">(</span><span class="n">otu_train</span><span class="p">[</span><span class="o">-</span><span class="n">ncol</span><span class="p">(</span><span class="n">otu_train</span><span class="p">)],</span><span class="w"> </span><span class="n">otu_train</span><span class="o">$</span><span class="n">Age</span><span class="p">,</span><span class="w"> </span><span class="n">cv.fold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">),</span><span class="w"> </span><span class="n">simplify</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">otu_train.cv</span><span class="w">
</span><span class="n">otu_train.cv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="n">otu_train.cv</span><span class="p">,</span><span class="w"> </span><span class="s1">'[['</span><span class="p">,</span><span class="w"> </span><span class="s1">'error.cv'</span><span class="p">))</span><span class="w">
</span><span class="n">otu_train.cv</span><span class="o">$</span><span class="n">otus</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">otu_train.cv</span><span class="p">)</span><span class="w">
</span><span class="n">otu_train.cv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">reshape2</span><span class="o">::</span><span class="n">melt</span><span class="p">(</span><span class="n">otu_train.cv</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'otus'</span><span class="p">)</span><span class="w">
</span><span class="n">otu_train.cv</span><span class="o">$</span><span class="n">otus</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">otu_train.cv</span><span class="o">$</span><span class="n">otus</span><span class="p">))</span><span class="w">
</span><span class="n">otu_train.cv.mean</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aggregate</span><span class="p">(</span><span class="n">otu_train.cv</span><span class="o">$</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">otu_train.cv</span><span class="o">$</span><span class="n">otus</span><span class="p">),</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">otu_train.cv.mean</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">Group.1</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">theme</span><span class="p">(</span><span class="n">panel.grid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w"> </span><span class="n">panel.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_rect</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'black'</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'transparent'</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span><span class="p">,</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Number of OTUs'</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Cross-validation error'</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">otu_train.cv.mean</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Group.1         x     1        1 21.164391     2        2 16.759359     3        3 14.546684     4        4 13.048069     5        6 11.507501     6        9 10.893205     7       14 10.096992     8       21  9.880045     9       31  9.606862     10      47  9.338943     11      71  9.267957     12     106  9.242369     13     159  9.274685     14     239  9.257842     15     358  9.265815     16     537  9.412580  
</code></pre></div>  </div>
</blockquote>

<p>ç»“æœä»ç„¶æ˜¯21.æˆ‘ä»¬é€‰æ‹©è¿™21ä¸ªè¿›è¡Œå›å½’æµ‹è¯•ï¼šå…¶å›å½’å˜é‡è§£é‡Šä¸ºï¼š</p>

<blockquote>
  <p>Call:
randomForest(formula = Age ~ ., data = otu_train.select, importance = TRUE) 
        Type of random forest: regression
              Number of trees: 500
No. of variables tried at each split: 7</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      Mean of squared residuals: 9.041955
                % Var explained: 63.52 è€Œæµ‹è¯•é›†çš„ç»“æœä¸ºï¼š
</code></pre></div></div>

<blockquote>
  <p>Call:
lm(formula = age_predict ~ otu_test.select.Age, data = Test_data)</p>

  <p>Residuals:
   Min      1Q  Median      3Q     Max 
-7.0720 -1.5880  0.0597  1.6154  6.9139</p>

  <p>Coefficients:
                   Estimate Std. Error t value Pr(&gt;|t|)  <br />
(Intercept)          3.86618    0.28879   13.39   &lt;2e-16 *****</p>

  <p><em>*otu_test.select.Age  0.52134    0.02876   18.13   &lt;2e-16 **</em></p>

  <p>Signif. codes:  0 â€˜<em><strong>â€™ 0.001 â€˜</strong>â€™ 0.01 â€˜</em>â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1</p>

  <p>Residual standard error: 2.417 on 271 degrees of freedom
Multiple R-squared:  0.548,	Adjusted R-squared:  0.5464 
F-statistic: 328.6 on 1 and 271 DF,  p-value: &lt; 2.2e-16</p>
</blockquote>

<p>åœ¨é€‰å–18æœˆä¹‹å‰çš„æ•°æ®ä½œä¸ºåˆ†æå‘ç°ï¼Œæ•´ä½“çš„å›å½’æ€§èƒ½å˜å·®äº†ã€‚</p>

<h3 id="bangladesh-only-analysis">Bangladesh only analysis</h3>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">otu_bangladesh</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">na.omit</span><span class="p">(</span><span class="n">otu</span><span class="p">[</span><span class="n">rownames</span><span class="p">(</span><span class="n">metadata</span><span class="p">)[</span><span class="n">which</span><span class="p">(</span><span class="n">metadata</span><span class="o">$</span><span class="n">Type</span><span class="o">==</span><span class="s2">"Bangladesh"</span><span class="p">)],])</span><span class="w">
</span><span class="c1">## å…±895ä¸ªæ ·æœ¬</span><span class="w">
</span><span class="n">train_index</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="n">rownames</span><span class="p">(</span><span class="n">otu_bangladesh</span><span class="p">),</span><span class="n">nrow</span><span class="p">(</span><span class="n">otu_bangladesh</span><span class="p">)</span><span class="o">*</span><span class="m">0.7</span><span class="p">)</span><span class="w"> </span><span class="c1">#626 samples</span><span class="w">
</span><span class="n">valid_index</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">setdiff</span><span class="p">(</span><span class="n">rownames</span><span class="p">(</span><span class="n">otu_bangladesh</span><span class="p">),</span><span class="n">train_index</span><span class="p">)</span><span class="w"> </span><span class="c1"># 269 samples</span><span class="w">
</span><span class="n">train_sample</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">otu_bangladesh</span><span class="p">[</span><span class="n">train_index</span><span class="p">,]</span><span class="w">
</span><span class="n">valid_sample</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">otu_bangladesh</span><span class="p">[</span><span class="n">valid_index</span><span class="p">,]</span><span class="w">
</span><span class="c1"># RF Glimpse</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span><span class="w">  </span><span class="c1"># åˆ›å»ºéšæœºç§å­ï¼Œä»è€Œä½¿å¾—ç»“æœå¯é‡å¤</span><span class="w">
</span><span class="n">otu_train.forest</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">randomForest</span><span class="p">(</span><span class="n">Age</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train_sample</span><span class="p">,</span><span class="w"> </span><span class="n">importance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="c1">## å¼€å§‹è®­ç»ƒ</span><span class="w">
</span><span class="n">otu_train.forest</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>Call:
randomForest(formula = Age ~ ., data = train_sample, importance = TRUE) 
              Type of random forest: regression
                    Number of trees: 500
No. of variables tried at each split: 179</p>

  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     Mean of squared residuals: 12.52807
               % Var explained: 72.18
</code></pre></div>  </div>
</blockquote>

<p>äº”æŠ˜äº¤å‰éªŒè¯çš„ç»“æ„è¡¨æ˜åœ¨ä»¥featureæ•°ç›®ä¸º9çš„æ—¶å€™å°±å‡ºç°äº†æ˜æ˜¾çš„è¯¯å·®é€Ÿç‡å‡å°‘ï¼Œä¸ºäº†ä¾¿äºæ¯”è¾ƒï¼Œæˆ‘ä»¬ä»ç„¶é€‰æ‹©21ä¸ªfeatureè¿›è¡Œè®¡ç®—ã€‚</p>

<blockquote>
  <p>Group.1        x<br />
  1        1 34.08701<br />
  2        2 25.09412<br />
  3        3 20.06591<br />
  4        4 18.30999<br />
  5        6 16.55228<br />
  6        9 15.56560<br />
  7       14 14.50420<br />
  8       21 14.25866<br />
  9       31 14.07609<br />
  10      47 13.83201<br />
  11      71 13.42821<br />
  12     106 13.42704<br />
  13     159 13.34986<br />
  14     239 13.36199<br />
  15     358 13.48967<br />
  16     537 13.49233</p>
</blockquote>

<p>ä¸Šè¿°ç»“æœä¸ºï¼š</p>

<blockquote>
  <p>Call:
randomForest(formula = Age ~ ., data = otu_train.select, importance = TRUE) 
              Type of random forest: regression
                    Number of trees: 500
No. of variables tried at each split: 7</p>

  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     Mean of squared residuals: 13.46171
               % Var explained: 70.11
</code></pre></div>  </div>
</blockquote>

<p>è¯¥ç»“æœæ˜¯è¾ƒä¸ºç²¾å‡†çš„ã€‚</p>

<h4 id="ç»“æœæ¯”è¾ƒ">ç»“æœæ¯”è¾ƒ</h4>

<p>æˆ‘ä»¬å°†ä»…ç”±Bangladeshçš„æ•°æ®å’Œåˆå¹¶æ•°æ®çš„ç‰©ç§ASVè¿›è¡Œæ¯”è¾ƒï¼Œå…¶ä¸­14ä¸ªç‰©ç§æ˜¯å…±æœ‰çš„ã€‚</p>

<table>
  <thead>
    <tr>
      <th>Taxon_Different</th>
      <th>Confidence</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ca033ba99529a006cd0c11e92fb8e942</td>
      <td>Bacteria; Firmicutes; Erysipelotrichi; Erysipelotrichales;  Erysipelotrichaceae; Catenibacterium; s__</td>
    </tr>
    <tr>
      <td>b6a27409a4e20ef37eec8b1c67c6c076</td>
      <td>Bacteria</td>
    </tr>
    <tr>
      <td>648ca9256127f35fad4013e8f62cef3b</td>
      <td>Bacteria</td>
    </tr>
    <tr>
      <td>1c4b3a88cb2d430b45d61279400da346</td>
      <td>Bacteria</td>
    </tr>
    <tr>
      <td>1b369a94dfbe2959f70aa4e147b09420</td>
      <td>Bacteria; Firmicutes; Bacilli; Lactobacillales; Streptococcaceae;  Streptococcus; s__luteciae</td>
    </tr>
    <tr>
      <td>dea94664b6e8ad6823604fa2c8f2eb4e</td>
      <td>Bacteria; Firmicutes; Bacilli; Lactobacillales; Streptococcaceae;  Streptococcus; s__</td>
    </tr>
    <tr>
      <td>5d5e07a2af7eac6b0b0602d5a163a02e</td>
      <td>Bacteria; Actinobacteria; Actinobacteria; Bifidobacteriales;  Bifidobacteriaceae; Bifidobacterium; s__bifidum</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>Taxon_Same</th>
      <th>Confidence</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>f118662f3e5f209f582ffbaf39e21807</td>
      <td>Bacteria; Firmicutes; Clostridia; Clostridiales; Lachnospiraceae;  Blautia; s__</td>
    </tr>
    <tr>
      <td>c3ae999022b2b3dba38bf8d4e08242c1</td>
      <td><strong>Bacteria; Firmicutes; Clostridia; Clostridiales; Lachnospiraceae; Dorea;  s__formicigenerans</strong></td>
    </tr>
    <tr>
      <td>c7dad10896f6c10619ec4d963d5a0d4c</td>
      <td><strong>Bacteria; Firmicutes; Clostridia; Clostridiales; Lachnospiraceae; Dorea;  s__longicatena</strong></td>
    </tr>
    <tr>
      <td>6c38c23dde65be3184382ccaafdbc7aa</td>
      <td><strong>Bacteria; Firmicutes; Bacilli; Bacillales; Staphylococcaceae;  Staphylococcus</strong></td>
    </tr>
    <tr>
      <td>f00219cfb5ea9d13f4be1e63c6822722</td>
      <td><strong>Bacteria; Firmicutes; Clostridia; Clostridiales; Ruminococcaceae;  Faecalibacterium; s__prausnitzii</strong></td>
    </tr>
    <tr>
      <td>c60a6281dea0f58a0154c2efcdb19cff</td>
      <td><strong>Bacteria; Firmicutes; Bacilli; Lactobacillales; Lactobacillaceae;  Lactobacillus; s__ruminis</strong></td>
    </tr>
    <tr>
      <td>c878ea3979de4d780d7e3e9b37797c9f</td>
      <td><strong>Bacteria; Actinobacteria; Actinobacteria; Bifidobacteriales;  Bifidobacteriaceae; Bifidobacterium; s__</strong></td>
    </tr>
    <tr>
      <td>b99a5879168a9d117fdffb707e1f682c</td>
      <td>Bacteria; Firmicutes; Clostridia; Clostridiales; Lachnospiraceae;  Blautia; s__</td>
    </tr>
    <tr>
      <td>2ea082fe7de3327a025e61006313746b</td>
      <td><strong>Bacteria; Proteobacteria; Gammaproteobacteria; Pasteurellales;  Pasteurellaceae; Haemophilus; s__parainfluenzae</strong></td>
    </tr>
    <tr>
      <td>ed8930aed9ccc63f5b22fd4229ef3361</td>
      <td>Bacteria; Firmicutes; Clostridia; Clostridiales; Ruminococcaceae;  Gemmiger; s__formicilis</td>
    </tr>
    <tr>
      <td>b97be820e4bf0d5a3c32cfb1f1512a40</td>
      <td>Bacteria</td>
    </tr>
    <tr>
      <td>2792f7e5c84a91ba5a549be947465cb6</td>
      <td><strong>Bacteria; Actinobacteria; Actinobacteria; Bifidobacteriales;  Bifidobacteriaceae; Bifidobacterium</strong></td>
    </tr>
    <tr>
      <td>fd0a3dc53155f8a85951b9ee8addb8b0</td>
      <td><strong>Bacteria; Firmicutes; Bacilli; Lactobacillales; Lactobacillaceae;  Lactobacillus; s__mucosae</strong></td>
    </tr>
    <tr>
      <td>3a9fc45622619d3fd38007c1852eb7cd</td>
      <td>Bacteria; Bacteroidetes; Bacteroidia; Bacteroidales; Prevotellaceae;  Prevotella; s__copri</td>
    </tr>
  </tbody>
</table>

<p>ä¸Šè¿°14ä¸ªä¿ç•™ç‰©ç§åœ¨åŸæ–‡ä¸­top24çš„ä»¥åŠ ç²—å½¢å¼æ˜¾ç¤ºã€‚</p>

<h2 id="åˆ†é˜¶æ®µéšæœºæ£®æ—åˆ†ç±»">åˆ†é˜¶æ®µéšæœºæ£®æ—åˆ†ç±»</h2>

<p>ä¸Šè¿°æ¨¡å‹æ˜¯ä»¥æ¯ä¸ªå¾®ç”Ÿç‰©ï¼ˆç»†èŒï¼‰çš„ä¸°åº¦å’Œå¹´é¾„è¿›è¡Œçš„å›å½’ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©åˆ†é˜¶æ®µåšåˆ†ç±»ä»»åŠ¡é¢„æµ‹ã€‚</p>

<p>æ•´ä¸ªæ•°æ®çš„å¹´é¾„åˆ†å¸ƒ:</p>

<p><img src="https://hugo-blog-1256988836.cos.ap-chengdu.myqcloud.com/16S/Micor-develop/ref7_13/classification/age_distribution.png" style="width:30px height:20px" /></p>

<p>è½½å…¥packagesï¼š</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">randomForest</span><span class="p">)</span><span class="w">
</span><span class="n">require</span><span class="p">(</span><span class="n">caTools</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ROSE</span><span class="p">)</span><span class="w"> </span><span class="c1">## è§£å†³æ ·æœ¬ä¸å‡è¡¡é—®é¢˜</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">doBy</span><span class="p">)</span><span class="w">  </span><span class="c1">#æ–¹ä¾¿åŸºäºåˆ†ç»„å–å‡å€¼ï¼Œä½¿ç”¨å…¶ä¸­çš„summaryBy()å‘½ä»¤</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span><span class="w">    </span><span class="c1">#æ–¹ä¾¿æ’åˆ—è¡¨æ ¼ï¼Œä½¿ç”¨å…¶ä¸­çš„melt()å‘½ä»¤</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">pROC</span><span class="p">)</span><span class="w">  </span><span class="c1"># ç»˜åˆ¶ROCæ›²çº¿</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">caret</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">pheatmap</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="éšæœºæ£®æ—æ„å»º">éšæœºæ£®æ—æ„å»º</h3>

<p>åˆ›å»ºstage:</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">metadata</span><span class="o">$</span><span class="n">stage</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">dim</span><span class="p">(</span><span class="n">metadata</span><span class="p">)[</span><span class="m">1</span><span class="p">])</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">metadata</span><span class="o">$</span><span class="n">Age</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="n">metadata</span><span class="o">$</span><span class="n">stage</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"I"</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">metadata</span><span class="o">$</span><span class="n">Age</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="m">1</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">metadata</span><span class="o">$</span><span class="n">Age</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;=</span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="n">metadata</span><span class="o">$</span><span class="n">stage</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"II"</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">metadata</span><span class="o">$</span><span class="n">Age</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="m">3</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">metadata</span><span class="o">$</span><span class="n">Age</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;=</span><span class="m">6</span><span class="p">)</span><span class="w"> </span><span class="n">metadata</span><span class="o">$</span><span class="n">stage</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"III"</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">metadata</span><span class="o">$</span><span class="n">Age</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="m">6</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">metadata</span><span class="o">$</span><span class="n">Age</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;=</span><span class="m">12</span><span class="p">)</span><span class="w"> </span><span class="n">metadata</span><span class="o">$</span><span class="n">stage</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"IV"</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">metadata</span><span class="o">$</span><span class="n">Age</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="m">12</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">metadata</span><span class="o">$</span><span class="n">Age</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;=</span><span class="m">18</span><span class="p">)</span><span class="w"> </span><span class="n">metadata</span><span class="o">$</span><span class="n">stage</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"V"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">dim</span><span class="p">(</span><span class="n">metadata</span><span class="p">)[</span><span class="m">1</span><span class="p">])</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">metadata</span><span class="o">$</span><span class="n">Age</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;=</span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="n">metadata</span><span class="o">$</span><span class="n">stage</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"I"</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">metadata</span><span class="o">$</span><span class="n">Age</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="m">3</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">metadata</span><span class="o">$</span><span class="n">Age</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;=</span><span class="m">6</span><span class="p">)</span><span class="w"> </span><span class="n">metadata</span><span class="o">$</span><span class="n">stage</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"II"</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">metadata</span><span class="o">$</span><span class="n">Age</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="m">6</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">metadata</span><span class="o">$</span><span class="n">Age</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;=</span><span class="m">12</span><span class="p">)</span><span class="w"> </span><span class="n">metadata</span><span class="o">$</span><span class="n">stage</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"III"</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">metadata</span><span class="o">$</span><span class="n">Age</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="m">12</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">metadata</span><span class="o">$</span><span class="n">Age</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;=</span><span class="m">18</span><span class="p">)</span><span class="w"> </span><span class="n">metadata</span><span class="o">$</span><span class="n">stage</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"IV"</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">metadata</span><span class="o">$</span><span class="n">Age</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="m">18</span><span class="p">)</span><span class="w"> </span><span class="n">metadata</span><span class="o">$</span><span class="n">stage</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"V"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">metadata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">na.omit</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span><span class="w">
</span><span class="n">otu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">filter_abundance</span><span class="p">))</span><span class="w">
</span><span class="n">otu</span><span class="o">$</span><span class="n">stage</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">metadata</span><span class="p">[</span><span class="n">rownames</span><span class="p">(</span><span class="n">otu</span><span class="p">),]</span><span class="o">$</span><span class="n">stage</span><span class="w">
</span><span class="n">otu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">na.omit</span><span class="p">(</span><span class="n">otu</span><span class="p">)</span><span class="w"> </span><span class="c1"># ä¿ç•™äº†910ä¸ªæ ·æœ¬</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">otu</span><span class="o">$</span><span class="n">stage</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<table>
  <thead>
    <tr>
      <th>I</th>
      <th>II</th>
      <th>III</th>
      <th>IV</th>
      <th>V</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>58</td>
      <td>110</td>
      <td>156</td>
      <td>340</td>
      <td>246</td>
    </tr>
  </tbody>
</table>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">1234</span><span class="p">)</span><span class="w">  </span><span class="c1">##ç¡®ä¿ç»“æœå¯é‡å¤</span><span class="w">
</span><span class="n">train_index</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="n">rownames</span><span class="p">(</span><span class="n">otu</span><span class="p">),</span><span class="n">nrow</span><span class="p">(</span><span class="n">otu</span><span class="p">)</span><span class="o">*</span><span class="m">0.7</span><span class="p">)</span><span class="w">
</span><span class="n">valid_index</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">setdiff</span><span class="p">(</span><span class="n">rownames</span><span class="p">(</span><span class="n">otu</span><span class="p">),</span><span class="n">train_index</span><span class="p">)</span><span class="w"> 
</span><span class="n">train_sample</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">transform</span><span class="p">(</span><span class="n">otu</span><span class="p">[</span><span class="n">train_index</span><span class="p">,],</span><span class="n">stage</span><span class="o">=</span><span class="n">as.factor</span><span class="p">(</span><span class="n">stage</span><span class="p">))</span><span class="w">
</span><span class="n">valid_sample</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">transform</span><span class="p">(</span><span class="n">otu</span><span class="p">[</span><span class="n">valid_index</span><span class="p">,],</span><span class="n">stage</span><span class="o">=</span><span class="n">as.factor</span><span class="p">(</span><span class="n">stage</span><span class="p">))</span><span class="w">

</span><span class="n">rf_ntree</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">randomForest</span><span class="p">(</span><span class="n">stage</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">train_sample</span><span class="p">,</span><span class="n">ntree</span><span class="o">=</span><span class="m">2000</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">rf_ntree</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://hugo-blog-1256988836.cos.ap-chengdu.myqcloud.com/16S/Micor-develop/ref7_13/classification/error_rate.png" alt="" /></p>

<p>å½“ntree=1000æ—¶ï¼Œæ¨¡å‹å†…çš„è¯¯å·®è¿˜ä¸å¤Ÿç¨³å®šï¼Œå¦å¤–ï¼Œæ•´ä½“é”™è¯¯ç‡ååˆ†çš„é«˜ï¼Œå…·æœ‰éå¸¸å·®çš„åˆ†ç±»æ•ˆæœã€‚æˆ‘ä»¬å‹‰å¼ºé‡‡å–<code class="language-plaintext highlighter-rouge">ntree=500</code>è¿›è¡Œè®¡ç®—</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">develop_rf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">randomForest</span><span class="p">(</span><span class="n">stage</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">train_sample</span><span class="p">,</span><span class="w"> </span><span class="n">ntree</span><span class="o">=</span><span class="m">500</span><span class="p">,</span><span class="n">proximity</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1"># develop_rf &lt;- randomForest(stage ~ ., train_sample, ntree=1000,proximity=TRUE)</span><span class="w">
</span><span class="n">develop_rf</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>Call:
randomForest(formula = stage ~ ., data = train_sample, ntree = 500,      proximity = TRUE) 
        Type of random forest: classification
              Number of trees: 500
No. of variables tried at each split: 23</p>

  <p>â€‹    OOB estimate of  error rate: 40.97%</p>

  <p>Confusion matrix:
    I II III  IV   V class.error
I   21  7   2   7   2   0.4615385
II   4 18  27  20   1   0.7428571
III  0 20  40  42   1   0.6116505
IV   3  9  15 184  34   0.2489796
V    0  0   1  66 113   0.3722222</p>
</blockquote>

<p>ä¸Šè¿°å±•ç¤ºçš„OOB errorä¸º40.97%ï¼Œæœ‰ç‚¹æƒ¨ä¸å¿ç¹ã€‚è¿™å¯èƒ½æ˜¯ç”±äºå¤šåˆ†ç±»ä»»åŠ¡çš„å¤æ‚æ€§å¸¦æ¥çš„ã€‚</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># è®¡ç®—æ¨¡å‹å˜é‡çš„é‡è¦æ€§</span><span class="w">
</span><span class="n">importance_otu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">importance</span><span class="p">(</span><span class="n">develop_rf</span><span class="p">))</span><span class="w">
</span><span class="n">importance_otu</span><span class="o">$</span><span class="n">accu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">
</span><span class="n">importance_otu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">importance_otu</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">importance_otu</span><span class="o">$</span><span class="n">MeanDecreaseGini</span><span class="p">,</span><span class="w"> </span><span class="n">decreasing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">

</span><span class="c1"># æ¨¡å‹è‡ªèº«æµ‹è¯•</span><span class="w">
</span><span class="n">pred1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">develop_rf</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train_sample</span><span class="p">)</span><span class="w">
</span><span class="n">freq1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">table</span><span class="p">(</span><span class="n">pred1</span><span class="p">,</span><span class="w"> </span><span class="n">train_sample</span><span class="o">$</span><span class="n">stage</span><span class="p">)</span><span class="w">
</span><span class="nf">sum</span><span class="p">(</span><span class="n">diag</span><span class="p">(</span><span class="n">freq1</span><span class="p">)</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">freq1</span><span class="p">))</span><span class="w">
</span><span class="c1"># the result is 0.5902669</span><span class="w">

</span><span class="n">test_predict</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">develop_rf</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">valid_sample</span><span class="p">)</span><span class="w">
</span><span class="n">cm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">table</span><span class="p">(</span><span class="n">valid_sample</span><span class="o">$</span><span class="n">stage</span><span class="p">,</span><span class="w"> </span><span class="n">test_predict</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<table>
  <thead>
    <tr>
      <th>Â </th>
      <th>I</th>
      <th>II</th>
      <th>III</th>
      <th>IV</th>
      <th>V</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>I</strong></td>
      <td>16</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td><strong>II</strong></td>
      <td>9</td>
      <td>15</td>
      <td>8</td>
      <td>7</td>
      <td>1</td>
    </tr>
    <tr>
      <td><strong>III</strong></td>
      <td>0</td>
      <td>7</td>
      <td>21</td>
      <td>22</td>
      <td>3</td>
    </tr>
    <tr>
      <td><strong>IV</strong></td>
      <td>2</td>
      <td>1</td>
      <td>5</td>
      <td>77</td>
      <td>10</td>
    </tr>
    <tr>
      <td><strong>V</strong></td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>26</td>
      <td>37</td>
    </tr>
  </tbody>
</table>

<p>ä¸Šè¿°æ··æ·†çŸ©é˜µçš„ç‰¹è‰²ä¸ºï¼Œå•ä¸ªåˆ†ç±»å¯èƒ½ä¼šé”™åˆ†åˆ°ä¸´è¿‘çš„å…¶ä»–åˆ†ç±»ï¼Œä½†æ˜¯<code class="language-plaintext highlighter-rouge">I</code>å¾ˆéš¾åˆ†åˆ°<code class="language-plaintext highlighter-rouge">V</code>,å³æ—¶é—´è·¨åº¦å¤§çš„é”™è¯¯åˆ†ç±»å¾ˆå°‘å‡ºç°ã€‚</p>

<p>è¿™å¼•å‡ºäº†ä¸€ä¸ªçŒœæƒ³ä¸ºï¼Œåœ¨å©´å„¿çš„å¾®ç”Ÿç‰©å‘å±•è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½å¹¶æœªæœ‰æ˜æ˜¾çš„æ€§åˆ«ç‰¹å¾èƒ½å¤Ÿå°†æ•°æ®åˆ’åˆ†ä¸ºä¸åŒçš„é˜¶æ®µï¼Œè€Œæ˜¯å¤„äºä¸€ç§è¿ç»­çš„æ¸å˜è¿‡ç¨‹ï¼Œä½†æ˜¯æ€»ä½“ä¸Šï¼Œå¦‚æœä¸¤ä¸ªé˜¶æ®µè·ç¦»è¾ƒè¿œï¼Œåˆ™å¾ˆå¯èƒ½å…·æœ‰è¾ƒå¤§çš„å¾®ç”Ÿç‰©ç¾¤è½å·®å¼‚ã€‚</p>

<h3 id="å˜é‡ç­›é€‰">å˜é‡ç­›é€‰</h3>

<p>å€ŸåŠ©äºè¿ç»­æ€§çš„å›å½’æ¨¡å‹ï¼Œæˆ‘ä»¬è¿˜æ˜¯é€‰æ‹©ä½¿ç”¨éƒ¨åˆ†ASVæ¥æŸ¥çœ‹è¿™äº›æ ·æœ¬çš„å˜åŒ–ã€‚æˆ‘ä»¬é€‰æ‹©50ä¸ªASVæ¥è¿›è¡Œéšæœºæ£®æ—æ„å»ºï¼ŒæŸ¥çœ‹ç»“æœã€‚</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">importance_otu_50</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">importance_otu</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">otu_select</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">importance_otu_50</span><span class="p">)</span><span class="w">
</span><span class="n">otu_train_50</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train_sample</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="n">otu_select</span><span class="p">,</span><span class="w"> </span><span class="s1">'stage'</span><span class="p">)]</span><span class="w">
</span><span class="n">otu_valid_50</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">valid_sample</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="n">otu_select</span><span class="p">,</span><span class="w"> </span><span class="s1">'stage'</span><span class="p">)]</span><span class="w">
</span><span class="n">otu_train.forest_50</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">randomForest</span><span class="p">(</span><span class="n">stage</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">otu_train_50</span><span class="p">,</span><span class="w"> </span><span class="n">importance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="n">proximity</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">valid_predict_50</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">otu_train.forest_50</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">otu_valid_50</span><span class="p">)</span><span class="w">
</span><span class="n">cm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">table</span><span class="p">(</span><span class="n">otu_valid_50</span><span class="o">$</span><span class="n">stage</span><span class="p">,</span><span class="w"> </span><span class="n">valid_predict_50</span><span class="p">)</span><span class="w"> </span><span class="c1"># æ··æ·†çŸ©é˜µ</span><span class="w">
</span><span class="nf">sum</span><span class="p">(</span><span class="n">diag</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">cm</span><span class="p">))</span><span class="w">  </span><span class="c1">## 0.5494505</span><span class="w">
</span><span class="n">cm</span><span class="w">
</span></code></pre></div></div>

<table>
  <thead>
    <tr>
      <th>Â </th>
      <th>I</th>
      <th>II</th>
      <th>III</th>
      <th>IV</th>
      <th>V</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>I</strong></td>
      <td>16</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td><strong>II</strong></td>
      <td>13</td>
      <td>10</td>
      <td>8</td>
      <td>8</td>
      <td>1</td>
    </tr>
    <tr>
      <td><strong>III</strong></td>
      <td>1</td>
      <td>6</td>
      <td>21</td>
      <td>22</td>
      <td>3</td>
    </tr>
    <tr>
      <td><strong>IV</strong></td>
      <td>3</td>
      <td>1</td>
      <td>10</td>
      <td>67</td>
      <td>14</td>
    </tr>
    <tr>
      <td><strong>V</strong></td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>29</td>
      <td>36</td>
    </tr>
  </tbody>
</table>

<p>æˆ‘ä»¬æƒ³çœ‹ä¸€ä¸‹è¿™ä¸ªç‰©ç§éƒ½å±äºä»€ä¹ˆï¼š</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">write.table</span><span class="p">(</span><span class="n">importance_otu_50</span><span class="p">,</span><span class="s2">"classification/importance_50_otu.txt"</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w">
</span><span class="n">ASV_taxa</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="s2">"taxonomy.txt"</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">,</span><span class="n">check.names</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w">
</span><span class="n">select</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="s2">"classification/importance_50_otu.txt"</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">,</span><span class="n">check.names</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w">
</span><span class="n">result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inner_join</span><span class="p">(</span><span class="n">ASV_taxa</span><span class="p">,</span><span class="n">select</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="s2">"ASV"</span><span class="p">)</span><span class="w">
</span><span class="n">result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">result</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">result</span><span class="o">$</span><span class="n">MeanDecreaseGini</span><span class="p">,</span><span class="w"> </span><span class="n">decreasing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">write.table</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="s2">"classification/Select_asv_taxa.txt"</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="nb">F</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>ç‰©ç§ç»“æœå¯è§äº<a href="https://hugo-blog-1256988836.cos.ap-chengdu.myqcloud.com/16S/Micor-develop/ref7_13/classification/Select_asv_taxa.txt">æ–‡æœ¬</a></p>

:ET