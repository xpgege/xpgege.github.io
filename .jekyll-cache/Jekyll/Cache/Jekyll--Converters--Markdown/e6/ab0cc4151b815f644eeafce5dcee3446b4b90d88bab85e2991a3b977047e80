I"Ø3<p>â€‹	2021å¹´7æœˆ15æ—¥,deepmindåœ¨CASP14ä¸­å¤§è·å…¨èƒœçš„alphafold2ç»ˆäºå¼€æºäº†ï¼ŒDemis Hassabisã€John Jumperç­‰äººåœ¨Natureæ‚å¿—ä¸Šå‘è¡¨äº†æ–‡ç« <a href="https://www.nature.com/articles/s41586-021-03819-2">Highly accurate protein structure prediction with AlphaFold</a>ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºç¥ç»ç½‘ç»œçš„æ–°æ¨¡å‹ï¼Œå…¶é¢„æµ‹çš„è›‹ç™½è´¨ç»“æ„èƒ½è¾¾åˆ°åŸå­æ°´å¹³çš„å‡†ç¡®åº¦ã€‚</p>

<p><img src="https://github.com/kuixu/alphafold/raw/main/imgs/casp14_predictions.gif" alt="CASP14 predictions" /></p>

<p>Deepmindåšå®¢æä¾›çš„ç»“æœï¼Œç»¿è‰²è¡¨ç¤ºå®éªŒç»“æœï¼Œè“è‰²è¡¨ç¤ºé¢„æµ‹ç»“æœï¼Œåœ¨è€ƒè™‘åˆ°å®éªŒè‡ªèº«è¯¯å·®çš„å‰æä¸‹ï¼Œalphafoldé¢„æµ‹çš„ç»“æœä¸å®éªŒç»“æœç›¸å·®æ— å‡ ã€‚</p>

<p><strong>github</strong>ï¼šhttps://github.com/deepmind/alphafold</p>

<hr />

<p>ä¸‹é¢æˆ‘è®°å½•ä¸€ä¸‹æˆ‘å®‰è£…alphafold2çš„è¸©å‘ï¼Œå…·ä½“è®ºæ–‡è§£æï¼Œæˆ‘å°†åé¢åœ¨è¿›ä¸€æ­¥äº†è§£</p>

<h1 id="å®‰è£…æµç¨‹">å®‰è£…æµç¨‹</h1>

<p><strong>slightly simplified version of AlphaFold</strong></p>

<p>å¯ä»¥è¿›å…¥æ³¨å†Œç™»é™†è°·æ­Œ<a href="https://colab.research.google.com/github/deepmind/alphafold/blob/main/notebooks/AlphaFold.ipynb">colab</a>ï¼Œç›´æ¥ç½‘é¡µç«¯è¿›è¡Œé¢„æµ‹</p>

<p><img src="https://i.loli.net/2021/07/29/8vUygOhpKcDHuCP.png" alt="æˆªå›¾å½•å±_é€‰æ‹©åŒºåŸŸ_20210729151713" /></p>

<hr />

<p><strong>whole version of AlphaFold</strong></p>

<ol>
  <li>
    <p>Install <a href="https://www.docker.com/">Docker</a>.</p>

    <ul>
      <li>Install <a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html">NVIDIA Container Toolkit</a> for GPU support.</li>
      <li>Setup running <a href="https://docs.docker.com/engine/install/linux-postinstall/#manage-docker-as-a-non-root-user">Docker as a non-root user</a>.</li>
    </ul>
  </li>
  <li>
    <p>Download genetic databases (see below).</p>
  </li>
  <li>
    <p>Download model parameters (see below).</p>
  </li>
  <li>
    <p>Check that AlphaFold will be able to use a GPU by running:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run --rm --gpus all nvidia/cuda:11.0-base nvidia-smi
</code></pre></div>    </div>

    <p>The output of this command should show a list of your GPUs. If it doesnâ€™t, check if you followed all steps correctly when setting up the <a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html">NVIDIA Container Toolkit</a> or take a look at the following <a href="https://github.com/NVIDIA/nvidia-docker/issues/1447#issuecomment-801479573">NVIDIA Docker issue</a>.</p>
  </li>
</ol>

<p>ä¸Šé¢ä¸ºå®˜æ–¹æä¾›çš„æµç¨‹</p>

<hr />

<h2 id="1git-clone">1.git clone</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/deepmind/alphafold
unzip alphafold-main.zip
cd alphafold-main
</code></pre></div></div>

<h2 id="2ä¸‹è½½database">2.ä¸‹è½½database</h2>

<p><img src="https://i.loli.net/2021/07/29/tiRev1oEfIbWj5G.png" alt="æˆªå›¾å½•å±_é€‰æ‹©åŒºåŸŸ_20210729152350" /></p>

<p><strong>The total download size for the full databases is around 415 GB and the total size when unzipped is 2.2 TB.</strong></p>

<p>å®˜æ–¹æä¾›scriptè„šæœ¬ç”¨äºä¸‹è½½æ•°æ®åº“ï¼Œæå‰å®‰è£…<code class="language-plaintext highlighter-rouge">aria2c</code>å’Œ<code class="language-plaintext highlighter-rouge">rsync</code></p>

<p><img src="https://i.loli.net/2021/07/29/jyOZa3eSAkxvRId.png" alt="æˆªå›¾å½•å±_é€‰æ‹©åŒºåŸŸ_20210729152957" style="zoom:150%;" /></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>database
sh scripts scripts/download_all_data.sh database
</code></pre></div></div>

<p>aria2cä¼šåˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œå æ®ç›®æ ‡ä¸‹è½½æ–‡ä»¶çš„ç©ºé—´ï¼Œå¦‚mgy_clusters_2018_12.fa.gzï¼Œå®ƒä¼šç›´æ¥å æ®32.9Gç©ºé—´ï¼Œç„¶åå†è¿›è¡Œä¸‹è½½ã€‚</p>

<p>ç”±äºä¸çŸ¥æ˜¯å¦æ˜¯å›½å†…ç½‘é€Ÿé—®é¢˜ï¼Œaria2cä¸‹è½½é€Ÿåº¦å®åœ¨è¿‡æ…¢ï¼Œä»…å‡ ç™¾kbï¼Œè€Œä¸”ååˆ†ä¸ç¨³å®š</p>

<p>æ•…æˆ‘ç”¨<strong>axel</strong>ä»£æ›¿<strong>aria2c</strong>ï¼Œaxelæ˜¯ä¸€ç§å¤šçº¿ç¨‹ä¸‹è½½å·¥å…·</p>

<p>å°†æ‰€æœ‰è„šæœ¬ä¸­</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aria2c "${SOURCE_URL}" --dir="${ROOT_DIR}"
æ›¿æ¢æˆ
axel -n 20 -N "${SOURCE_URL}" -o "${ROOT_DIR}"
</code></pre></div></div>

<p>axel ä¸‹è½½å‚æ•°å¦‚https://blog.csdn.net/yangl2512/article/details/6833547</p>

<p><strong>æˆ‘èŠ±äº†ä¸¤å¤©ä¸‹è½½ï¼Œä¸»è¦æ˜¯rsyncåŒæ­¥é€Ÿåº¦è¿‡æ…¢ï¼Œè€Œä¸”Running rsync to fetch all mmCIF files (note that the rsync progress estimate might be inaccurate)â€¦ï¼Œè¿™ä¸æ˜¯ä¸å‡†ç¡®ï¼Œæ˜¯ç›¸å½“ä¸å‡†ç¡®ï¼Œç¬¬ä¸€å¤©æ™šä¸Šæˆ‘çœ‹åˆ°åŒæ­¥äº†99%ï¼ŒçŸ¥é“ç¬¬äºŒå¤©æ™šä¸Šå˜æˆ98%äº†â€¦..</strong></p>

<h2 id="3docker-åˆ›å»ºç¯å¢ƒ">3.docker åˆ›å»ºç¯å¢ƒ</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build -f docker/Dockerfile -t alphafold .
#-f æŒ‡å®šdockerfile è·¯å¾„
#-t æŒ‡å®šdocker imageçš„label
</code></pre></div></div>

<p>ç„¶è€Œè¿™ä¸€æ­¥éœ€è¦2.41Tç©ºé—´æ¥å‚¨å­˜docker imageï¼Œè€Œdocker é•œåƒä¸€èˆ¬å‚¨å­˜åœ¨/var/lib/docker/ï¼Œç©ºé—´ä¸å¤Ÿï¼Œæ‰€ä»¥è¦å°†docker é•œåƒå‚¨å­˜ç›®å½•è¿ç§»åˆ°æ›´å¤§çš„ç£ç›˜ä¸Šã€‚</p>

<p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/linux123/p/12176784.html">dockerç£ç›˜ç©ºé—´ä¸è¶³è§£å†³åŠæ³• - éª‘é©¬æŒæªæ‰“å¤©ä¸‹ - åšå®¢å›­</a></p>

<p>ä½†æ˜¯è¿™ä¸€æ¬¡æˆ‘æ²¡æœ‰æˆåŠŸ..ï¼ˆä»¥å‰æˆ‘åšçš„æ—¶å€™æˆåŠŸäº†ï¼‰</p>

<p><img src="https://i.loli.net/2021/07/29/lxyvLzbGUHtBmEj.png" alt="æˆªå›¾å½•å±_é€‰æ‹©åŒºåŸŸ_20210726160825" /></p>

<p>å› ä¸ºéƒ¨åˆ†åœ¨docker/lib/overlay2ä¸­çš„æ–‡ä»¶æˆ‘æ— æ³•æ“ä½œï¼Œå³ä½¿æˆ‘sudo/su root</p>

<p>å°è¯•äº†å¾ˆä¹…éƒ½æ‰¾ä¸åˆ°å‡†ç¡®çš„ç­”æ¡ˆ</p>

<p>å¯èƒ½åŸå› ï¼š</p>

<p>1.æŒ‚è½½/mnt/storageç£ç›˜æ ¼å¼çš„é—®é¢˜</p>

<p>2.dockeré•œåƒå†…éƒ¨æƒé™çš„é—®é¢˜ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®å†…éƒ¨æ–‡ä»¶</p>

<p>ï¼ˆå¸Œæœ›çŸ¥é“çš„æœ‹å‹èƒ½æŒ‡ç‚¹ä¸€äºŒï¼‰</p>

<h2 id="3no-dockerbut-conda">3*.no dockerï¼Œbut conda</h2>

<p>åœ¨alphafold github issueä¸­å‘ç°kuixu ä¸åˆ©ç”¨docker çš„alphafoldæ”¹è¿›ç‰ˆæœ¬</p>

<p>https://github.com/kuixu/alphafold</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/kuixu/alphafold
conda create -n af2 python=3.8 -y
conda activate af2

conda install -y -c nvidia cudnn==8.0.4
conda install -y -c bioconda hmmer hhsuite==3.3.0 kalign2

conda install -y -c conda-forge \
    openmm=7.5.1 \
    pdbfixer \
    pip

# python pkgs
pip3 install --upgrade pip \
    &amp;&amp; pip3 install -r ./requirements.txt \
    &amp;&amp; pip3 install --upgrade "jax[cuda111]" -f \
    https://storage.googleapis.com/jax-releases/jax_releases.html

# work_path=/path/to/alphafold-code
work_path=$(PWD)

# update openmm 
a=$(which python)
cd $(dirname $(dirname $a))/lib/python3.8/site-packages
patch -p0 &lt; $work_path/docker/openmm.patch

</code></pre></div></div>

<p>python  åŠcudaå¯¹åº”ç‰ˆæœ¬å¦‚å›¾æ‰€ï¼Œç¤ºè¯·æ ¹æ®è‡ªå·±gpuè®¾å¤‡æƒ…å†µå¯¹ cudnn tensorflowç‰ˆæœ¬ è¿›è¡Œä¿®æ”¹</p>

<p><img src="https://i.loli.net/2021/07/29/r7ITlmXU8jqBs1M.png" alt="æˆªå›¾å½•å±_é€‰æ‹©åŒºåŸŸ_20210729161407" /></p>

<p>ï¼ˆå…¶ä¸­<strong>jax</strong> æ˜¯googleçš„ä¸€ç§æ–°çš„AIæ¡†æ¶ï¼Œç»“åˆäº†tensorflowå’Œpytorchçš„ä¼˜ç‚¹ï¼Œå¦‚ç»“åˆäº†gpuåŠ é€Ÿçš„numpy ï¼ŒåŒæ ·çš„æ•°å­¦è¿ç®—ï¼Œç”¨JAXç‰ˆçš„numpyå¯ä»¥åŠ å¿«30å¤šå€ï¼Œå› ä¸ºä½¿ç”¨äº†CUDA GPUåŠ é€Ÿï¼‰</p>

<p>jax github:https://github.com/google/jax#installation</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install --upgrade "jax[cuda111]" -f https://storage.googleapis.com/jax-releases/jax_releases.html

#For CUDA 11.1, 11.2, or 11.3, use cuda111. The same wheel should work for CUDA 11.x releases from 11.1 onwards.
For CUDA 11.0, use cuda110.
For CUDA 10.2, use cuda102.
For CUDA 10.1, use cuda101.
Older CUDA versions are not supported.
ï¼ˆæˆ‘ä»¬low bçš„å®éªŒå®¤è¿˜æ˜¯1080Tiï¼Œæˆ‘è‡ªå·±ç”µè„‘æ˜¾å¡éƒ½2060Tiäº†ï¼Œå®³ï¼Œè®©è€æ¿ä¹°æ˜¾å¡å»äº†ï¼‰
</code></pre></div></div>

<h2 id="4è¿è¡Œalphafold">4.è¿è¡Œalphafold</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim run_alphafold.py

ä¿®æ”¹å¦‚ä¸‹å†…å®¹
# Set to target of scripts/download_all_databases.sh
DOWNLOAD_DIR = '/path/to/database'

# Path to a directory that will store the results.
output_dir = '/path/to/output_dir'

uniclust30_database_path = os.path.join(
    #DOWNLOAD_DIR, 'uniclust30', 'UniRef30_2020_02','UniRef30_2020_02')
    DOWNLOAD_DIR, 'uniclust30', 'uniclust30_2018_08', 'uniclust30_2018_08')

</code></pre></div></div>

<p>åœ¨<a href="https://alphafold.ebi.ac.uk/">AlphaFold Protein Structure Database</a>é€‰äº†ä¸ªé•¿åº¦è¾ƒçŸ­çš„åºåˆ—</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://www.uniprot.org/uniprot/P26647.fasta
python3 run_alphafold.py --fasta_paths=P26647.fasta --max_template_date=2020-05-14
# or simply
exp/run_local.sh P26647.fasta
</code></pre></div></div>

<p><strong>å‚æ•°</strong>ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	  'fasta_paths',
      'output_dir',
      'model_names',
      'data_dir',
      'preset', 
      'uniref90_database_path',
      'mgnify_database_path',
      'uniclust30_database_path',
      'bfd_database_path',
      'pdb70_database_path',
      'template_mmcif_dir',
      'max_template_date',
      'obsolete_pdbs_path',
</code></pre></div></div>

<p>control AlphaFold speed / quality tradeoff by adding either <code class="language-plaintext highlighter-rouge">--preset=full_dbs</code> or <code class="language-plaintext highlighter-rouge">--preset=casp14</code> to the run command. We provide the following presets:</p>

<ul>
  <li>
    <p><strong>casp14</strong>: This preset uses the same settings as were used in CASP14. It runs with all genetic databases and with 8 ensemblings.ï¼ˆè´¨é‡ï¼‰</p>
  </li>
  <li>
    <p><strong>full_dbs</strong>: The model in this preset is 8 times faster than the <code class="language-plaintext highlighter-rouge">casp14</code> preset with a very minor quality drop (-0.1 average GDT drop on CASP14 domains). It runs with all genetic databases and with no ensembling.ï¼ˆé€Ÿåº¦ï¼‰</p>
  </li>
</ul>

<p><strong>è¾“å‡ºï¼š</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>output_dir/
    features.pkl
    ranked_{0,1,2,3,4}.pdb
    ranking_debug.json
    relaxed_model_{1,2,3,4,5}.pdb
    result_model_{1,2,3,4,5}.pkl
    timings.json
    unrelaxed_model_{1,2,3,4,5}.pdb
    msas/
        bfd_uniclust_hits.a3m
        mgnify_hits.sto
        uniref90_hits.sto


</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">features.pkl</code> â€“ A <code class="language-plaintext highlighter-rouge">pickle</code> file containing the input feature Numpy arrays used by the models to produce the structures.</li>
  <li><code class="language-plaintext highlighter-rouge">unrelaxed_model_*.pdb</code> â€“ A PDB format text file containing the predicted structure, exactly as outputted by the model.</li>
  <li><code class="language-plaintext highlighter-rouge">relaxed_model_*.pdb</code> â€“ A PDB format text file containing the predicted structure, after performing an Amber relaxation procedure on the unrelaxed structure prediction, see Jumper et al. 2021, Suppl. Methods 1.8.6 for details.</li>
  <li><code class="language-plaintext highlighter-rouge">ranked_*.pdb</code> â€“ A PDB format text file containing the relaxed predicted structures, after reordering by model confidence. Here <code class="language-plaintext highlighter-rouge">ranked_0.pdb</code> should contain the prediction with the highest confidence, and <code class="language-plaintext highlighter-rouge">ranked_4.pdb</code> the prediction with the lowest confidence. To rank model confidence, we use predicted LDDT (pLDDT), see Jumper et al. 2021, Suppl. Methods 1.9.6 for details.</li>
  <li><code class="language-plaintext highlighter-rouge">ranking_debug.json</code> â€“ A JSON format text file containing the pLDDT values used to perform the model ranking, and a mapping back to the original model names.</li>
  <li><code class="language-plaintext highlighter-rouge">timings.json</code> â€“ A JSON format text file containing the times taken to run each section of the AlphaFold pipeline.</li>
  <li><code class="language-plaintext highlighter-rouge">msas/</code> - A directory containing the files describing the various genetic tool hits that were used to construct the input MSA.</li>
  <li><code class="language-plaintext highlighter-rouge">result_model_*.pkl</code> â€“ A <code class="language-plaintext highlighter-rouge">pickle</code> file containing a nested dictionary of the various Numpy arrays directly produced by the model. In addition to the output of the structure module, this includes auxiliary outputs such as distograms and pLDDT scores. If using the pTM models then the pTM logits will also be contained in this file.</li>
</ul>

:ET